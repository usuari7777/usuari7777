<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Ejercicios propuestos - Parte 6 | Node.js</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Ejercicios propuestos - Parte 6" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Curso de Node.js elaborado por Nacho Iborra, profesor de ciclos formativos en el I.E.S. San Vicente (San Vicente del Raspeig, Alicante)" />
<meta property="og:description" content="Curso de Node.js elaborado por Nacho Iborra, profesor de ciclos formativos en el I.E.S. San Vicente (San Vicente del Raspeig, Alicante)" />
<link rel="canonical" href="06ejercicios.html" />
<meta property="og:url" content="http://nachoiborraies.github.io/nodejs/md/es/06ejercicios.html" />
<meta property="og:site_name" content="Node.js" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Ejercicios propuestos - Parte 6" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Curso de Node.js elaborado por Nacho Iborra, profesor de ciclos formativos en el I.E.S. San Vicente (San Vicente del Raspeig, Alicante)","headline":"Ejercicios propuestos - Parte 6","url":"http://nachoiborraies.github.io/nodejs/md/es/06ejercicios.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="http://nachoiborraies.github.io/nodejs/assets/css/style.css?v=6f3486a3f1037cd61ca1f16e7f6e1d3a46da2aad">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/nodejs/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="../../index.html">Node.js</a></h1>
      

      <h1 id="ejercicios-propuestos---parte-6">Ejercicios propuestos - Parte 6</h1>

<p>Para los ejercicios de esta sesión, crea una subcarpeta llamada “<strong>Sesion6</strong>” en tu carpeta “<strong>ProyectosNode/Ejercicios</strong>”, para dentro ir creando un proyecto para cada ejercicio.</p>

<h2 id="ejercicio-1">Ejercicio 1</h2>

<p>Crea una carpeta llamada “<strong>Ejercicio_6_1</strong>” en la carpeta de ejercicios “<em>ProyectosNode/Ejercicios/Sesion6</em>”. Copia dentro el contenido del <em>Ejercicio_5_3</em> de la sesión anterior, donde estructuramos la API REST de libros en diferentes carpetas con sus modelos y enrutadores.</p>

<p>Vamos a definir dos middlewares propios en nuestra aplicación de libros del ejercicio anterior:</p>

<ul>
  <li>Uno lo definiremos únicamente para el enrutador de libros (<code class="language-plaintext highlighter-rouge">routes/libros.js</code>), de forma que cada vez que accedamos a un servicio de ese enrutador, se mostrará por consola la fecha, método (GET, POST, etc) y URI solicitada. Para obtener estos dos últimos datos, deberás utilizar las propiedades <code class="language-plaintext highlighter-rouge">req.method</code> y <code class="language-plaintext highlighter-rouge">req.url</code> del objeto de la petición (<code class="language-plaintext highlighter-rouge">req</code>). También puedes usar <code class="language-plaintext highlighter-rouge">req.baseUrl</code> para obtener la URL base, en el caso de que utilices enrutadores con URL base, como en este ejercicio.</li>
  <li>El otro será global (en <code class="language-plaintext highlighter-rouge">index.js</code> o <code class="language-plaintext highlighter-rouge">app.js</code>, dependiendo de cómo hayas llamado al programa principal), y deberá enviar por JSON un mensaje de “En mantenimiento”, sin permitir acceder a ningún servicio (es decir, que no llame al método <code class="language-plaintext highlighter-rouge">next</code>). Siempre que este middleware esté activo, la aplicación no funcionará (sólo enviará “En mantenimiento” para cada solicitud que le llegue). Cuando se desactive/comente, la aplicación funcionará con normalidad.</li>
</ul>

<h2 id="ejercicio-2">Ejercicio 2</h2>

<p>Crea una carpeta llamada “<strong>Ejercicio_6_2</strong>” en la carpeta de ejercicios “<em>ProyectosNode/Ejercicios/Sesion6</em>”. De nuevo, copia dentro el contenido del <em>Ejercicio_5_3</em> de la sesión anterior.</p>

<p>Instala Nunjucks y Bootstrap en el nuevo proyecto, y deja un archivo principal <code class="language-plaintext highlighter-rouge">index.js</code> similar al del ejemplo de contactos, cargando las librerías, los enrutadores que haya, etc, y configurando Nunjucks como el motor de plantillas de la aplicación.</p>

<p>Vamos a definir dos vistas, asociadas a los dos enrutadores de listado de libros y ficha de libros, que vamos a modificar. Recuerda que deberás crear los archivos de las vistas en la carpeta <code class="language-plaintext highlighter-rouge">views</code> del proyecto:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">libros_listado.njk</code>: recibirá del enrutador GET para <code class="language-plaintext highlighter-rouge">/libros</code> el listado completo de libros, y mostrará el listado de libros por pantalla. Se deberá mostrar el título del libro, y a su lado, un enlace para ir a la ficha detallada del libro. Esta vista puede quedarte más o menos así. Puedes usar <code class="language-plaintext highlighter-rouge">class="btn btn-success"</code> en el enlace para mostrarlo con esa apariencia de botón en verde, gracias a Bootstrap:</li>
</ul>

<div align="center">
    <img src="http://nachoiborraies.github.io/nodejs/img/06_libros_listado.png" width="70%" />
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">libros_ficha.njk</code>: recibirá del enrutador GET para <code class="language-plaintext highlighter-rouge">/libros/:id</code> los datos del libro a mostrar. Se mostrarán sus datos con un formato como el que se indica a continuación</li>
</ul>

<div align="center">
    <img src="http://nachoiborraies.github.io/nodejs/img/06_libros_ficha.png" width="70%" />
</div>

<p>Además de las dos vistas anteriores, crea una nueva vista llamada <code class="language-plaintext highlighter-rouge">error.njk</code> en la carpeta de vistas, que recibirá como parámetro un mensaje de error y lo mostrará por pantalla con el formato que se indica a continuación. En caso de no recibir ningún mensaje de error, mostrará el mensaje genérico “Error en la aplicación”. Modifica el enrutador de la ficha de libros (GET <code class="language-plaintext highlighter-rouge">/libros/:id</code>) para que, en caso de no encontrar el libro buscado, se renderice esta otra vista con el mensaje “Libro no encontrado”.</p>

<p>Este es el estilo que puedes utilizar para mostrar el mensaje de error en la vista <code class="language-plaintext highlighter-rouge">error.njk</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Error<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span><span class="nt">&gt;</span>
    Libro no encontrado
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<div align="center">
    <img src="http://nachoiborraies.github.io/nodejs/img/06_mensaje_error.png" width="90%" />
</div>

<blockquote>
  <p><strong>NOTA:</strong> recuerda que los antiguos enrutadores que devolvían datos JSON deberán modificarse para renderizar las vistas correspondientes en este ejercicio. El resto de enrutadores que aún no hemos tocado (inserción o borrado de libros, por ejemplo), déjalos como estaban de la sesión anterior, y ya iremos modificándolos después.</p>
</blockquote>

<h2 id="ejercicio-3">Ejercicio 3</h2>

<p>Sobre el ejercicio anterior, vamos a hacer lo siguiente:</p>

<ul>
  <li>Crea una plantilla llamada <code class="language-plaintext highlighter-rouge">base.njk</code> que incorpore los elementos comunes a las vistas que has realizado: encabezado <em>head</em> con la inclusión de estilos, pie de página, etc. Deja dos bloques (<em>block</em>) editables llamados “titulo” y “contenido”, como en el ejemplo de contactos.</li>
  <li>Haz que las vistas <code class="language-plaintext highlighter-rouge">libros_listado.njk</code> y <code class="language-plaintext highlighter-rouge">libros_ficha.njk</code> hereden de esa base, y rellenen los bloques de “titulo” y “contenido” con sus propios datos.</li>
  <li>Define una nueva vista llamada <code class="language-plaintext highlighter-rouge">menu.njk</code> que muestre un menú de navegación con dos enlaces: uno para ir al listado de libros (URL <code class="language-plaintext highlighter-rouge">/libros</code>), y otro para ir al formulario de inserción de libros que implementaremos más adelante (URL <code class="language-plaintext highlighter-rouge">/libros/nuevo</code>). Incluye con <code class="language-plaintext highlighter-rouge">include</code> esta vista en la plantilla base, justo antes del bloque de “contenido”. Esta es la apariencia que puede tener más o menos la vista de listado ahora:</li>
</ul>

<div align="center">
    <img src="http://nachoiborraies.github.io/nodejs/img/06_libros_listado2.png" width="90%" />
</div>

<ul>
  <li>Implementa la inserción de nuevos libros. Para ello:
    <ul>
      <li>Define una vista llamada <code class="language-plaintext highlighter-rouge">libros_nuevo.njk</code> en la carpeta <code class="language-plaintext highlighter-rouge">views</code>, con un formulario que permita rellenar los datos de un nuevo libro. Puedes basarte en la vista hecha para insertar nuevos contactos, y modificar los campos del formulario para que sean los del libro. Haz que el formulario se envíe por POST a <code class="language-plaintext highlighter-rouge">/libros</code>.</li>
      <li>Define una ruta en <code class="language-plaintext highlighter-rouge">routes/libros.js</code> que responda a <code class="language-plaintext highlighter-rouge">/libros/nuevo</code> por GET, y renderice la vista <code class="language-plaintext highlighter-rouge">libros_nuevo</code> creada en el paso anterior.</li>
      <li>Define otra ruta en <code class="language-plaintext highlighter-rouge">routes/libros.js</code> que, con POST, responda a la URL <code class="language-plaintext highlighter-rouge">/libros</code>, recogiendo los datos del libro de la petición (recuerda configurar <em>express</em> como <code class="language-plaintext highlighter-rouge">urlencoded</code>), dé de alta el nuevo libro y redirija al listado de libros, o a una página de error, según sea el caso.</li>
    </ul>
  </li>
  <li>Finalmente, implementaremos el borrado de libros, siguiendo estos pasos:
    <ul>
      <li>Comenzaremos por instalar la librería <code class="language-plaintext highlighter-rouge">method-override</code> como hemos hecho en el ejemplo de los contactos, y la incorporamos al archivo principal <code class="language-plaintext highlighter-rouge">index.js</code></li>
      <li>Después, añadimos el mismo <em>middleware</em> que en el caso de los contactos para que busque un campo <code class="language-plaintext highlighter-rouge">_method</code> en el cuerpo de la petición, y lo use en lugar del <em>method</em> que pueda tener el formulario. Simplemente, copia y pega esa función del ejemplo de los contactos en el archivo principal de esta aplicación de libros, en el lugar indicado.</li>
      <li>A continuación, deberemos editar la vista de <code class="language-plaintext highlighter-rouge">libros_listado.njk</code> y añadir un formulario de borrado junto a cada libro, para que se envíe por DELETE a la ruta <code class="language-plaintext highlighter-rouge">/libros</code>, como en el ejemplo de los contactos.</li>
      <li>Finalmente, definimos la ruta en <code class="language-plaintext highlighter-rouge">routes/libros.js</code> para responder a esta llamada, eliminar el libro y redirigir al listado de libros, o a la vista de error, según el resultado de la operación.</li>
      <li>Aquí tenéis una captura de pantalla de cómo podría quedar la vista del listado de libros, con el nuevo formulario para borrar cada libro:</li>
    </ul>
  </li>
</ul>

<div align="center">
    <img src="http://nachoiborraies.github.io/nodejs/img/06_libros_borrar.png" width="90%" />
</div>

<blockquote>
  <p><strong>NOTA</strong>: El estilo de la barra de menú superior puede ser el que quieras, no tiene que ser necesariamente como en la imagen. También el estilo de los items del listado, o del formulario, pueden variar según tus propios gustos.</p>
</blockquote>

<h2 id="ejercicio-4">Ejercicio 4</h2>

<p><strong><em>Opcional</em></strong></p>

<p>Como ejercicio opcional de esta sesión, se deja que implementéis la edición de libros. Debería haber:</p>

<ul>
  <li>Un enlace/botón en el listado de libros que muestre el formulario del libro, con los campos ya rellenos</li>
  <li>Dicho formulario debería enviarse por PUT a la ruta de modificación de libros</li>
  <li>En dicha ruta, se modificarán los datos del libro que se reciba, y se redirigirá al listado de libros, o a la vista de error.</li>
</ul>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
